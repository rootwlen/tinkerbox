### 蜜罐搭建及简单使用

#### 一.什么是蜜罐？

蜜罐是一种主动防御技术，通过主动的暴露一些漏洞、设置一些诱饵来引诱攻击者进行攻击，从而可以对攻击行为进行捕获和分析。

#### 二.原理是什么？

蜜罐可以故意暴露一些易受攻击的端口，使这些端口保持在开放状态，主动诱使攻击者进入蜜罐环境中，而不是进入真实的系统。一旦攻击者进入蜜罐环境中，就可以连续跟踪攻击者的行为，实现对攻击者的捕获、攻击路径的溯源，并通过评估攻击者的攻击行为，获取有关如何使真实网络更安全的线索，进而通过技术和管理手段来增强实际系统的安全防护能力。

#### 三.蜜罐的分类



#### 四.研究现状



#### 五.蜜罐的缺点


1.传统的蜜罐是一个静态的、固定不变的网络陷阱，这种传统的蜜罐对于误入陷阱的攻击者是十分有效的，一旦攻击者意识到这是个陷阱，将会离开，蜜罐将失去功效。
2.在高交互的蜜罐中，除存在已知漏洞外，还存在未知的漏洞，已知漏洞是己方设置的诱饵，在己方的掌控中。但是未知漏洞是己方不知道的，没有办法掌握的，若遇到一个高级的攻击者，通过系统中存在的未知漏洞，攻破系统的防御体系，这个攻击者可能会把蜜罐当成一个跳板，对真实的业务系统展开攻击。
3.传统蜜罐对先验知识的强烈依赖，在进行自动化检测的时候，传统的检测方法都是基于先验知识的规则库进行检测。对于未知漏洞或协议缺陷等实施的未知攻击，将会存在大量的漏报、误报，蜜罐的作用将大大的打折扣。
4.蜜罐技术在数据搜集方面的局限性，蜜罐仅能捕获针对自身的攻击，如果攻击者所攻击的应用或服务不在蜜罐系统中，那么蜜罐将没有作用，将不能捕获到这次的攻击信息。
5.传统蜜罐技术不考虑未知后门，如果开发者为方便以后秘密进入或者控制系统在开发过程中故意留有后门，对蜜罐系统或对整个己方的真实系统都构成巨大威胁，传统蜜罐无法检测也无法对其进行防御。


#### 六.Hfish蜜罐的使用介绍


##### 1.什么是hfish蜜罐


是一款开源的基于 Golang 开发的跨平台多功能主动诱导型蜜罐平台，为了企业安全做出了精心的打造。 不仅仅支持 HTTP(S) 蜜罐，还支持 SSH、SFTP、Redis、Mysql、FTP、Telnet、暗网 等，还提供 API 接口，使用者可以随意扩展蜜罐模块，其侧重企业安全场景，从内网失陷检测、外网威胁感知、威胁情报生产三个场景出发，为用户提供可独立操作且实用的功能，通过安全、敏捷、可靠的中低交互蜜罐增加用户在失陷感知和威胁情报领域的能力。

##### 2.hfish蜜罐的原理


HFish蜜罐系统主要由管理端和节点端两部分组成，其中管理端是用来生成和管理节点端，同时负责接收、分析并展示节点端所回传的数据，节点端则接受管理端的控制并负责构建蜜罐服务。

![image-20240425002509634](C:\Users\wlen\AppData\Roaming\Typora\typora-user-images\image-20240425002509634.png)


##### 3.hfish蜜罐的典型应用


![image-20240425002640581](C:\Users\wlen\AppData\Roaming\Typora\typora-user-images\image-20240425002640581.png)![image-20240425002643582](C:\Users\wlen\AppData\Roaming\Typora\typora-user-images\image-20240425002643582.png)


内网部署：防御性蜜罐，监测内网攻击。
外网部署：对外进行映射，当做靶机来收集攻击数据，可以用来研究攻击态势。
注意：一定要避免蜜罐节点被当做攻击者的跳板机，要使用严格的策略来进行限制。

###### 3.1节点部署注意事项

1）用户如果同时使用内外网，最好分别在外网和内网部署两套独立的管理端和节点端。
2）如果有节点需要被外网访问，建议把节点和管理端部署在DMZ区域；
3）外网节点除了能范文管理端的TCP/443端口外，不能有权限访问内网中的任何资产；
4）内网节点除了开放蜜罐服务相应的端口外，其他任何端口都不应该在网络中能被用户访问到，如果有维护节点主机的需求，可以向有限的设备（堡垒机）开放SSH端口。

##### 4.Hfish特点

1）安全可靠：主打低中交互蜜罐，简单有效；
2）功能丰富：支持基本网络 服务、OA系统、CRM系统、NAS存储系统、Web服务器、运维平台、无线AP、交换机/路由器、邮件系统、IoT设备等40多种蜜罐服务，支持用户制作自定义Web蜜罐，支持用户进行流量牵引到云蜜网、可开关的扫描感知能力、支持可自定义的蜜饵配置；
3）开放透明：支持对接微步在线X社区API、五路syslog输出、支持邮件、钉钉、企业威胁、飞书、自定义WebHook告警输出；
4）快捷管理：支持单个安装包批量部署，支持批量修改端口和服务；
5）跨平台：支持Linux x32/x64/ARM、Windows x32/x64平台、国产操作系统、龙芯、海光、飞腾、鲲鹏、腾云、兆芯硬件；

##### 6.hfish蜜罐的搭建与部署

1.为了方便搭建，此处使用[Docker](https://so.csdn.net/so/search?q=Docker&spm=1001.2101.3001.7020)搭建Hfish蜜罐，项目官方地址：`https://hub.docker.com/r/imdevops/hfish`，镜像拉取如下：

```

docker images
docker search hfish
docker ps #查看全部docker
docker ps -a #查看正在运行的docker
docker stop <docker的名字> #停止docker
docker rm <docker的名字> #删除docker
netstat -tuln #查看开放的端口

```

2.

```
docker pull imdevops/hfish
```


3.端口映射


```
docker run -d --name hfish -p 21:21 -p 22:22 -p 23:23 -p 69:69 -p 3306:3306 -p 5900:5900 -p 6379:6379 -p 8080:8080 -p 8081:8081 -p 8989:8989 -p 9000:9000 -p 9001:9001 -p 9200:9200 -p 11211:11211 --restart=always imdevops/hfish:latest
```


容器启动成功后可先访问下 centos8虚拟机 9000 端口看看 Web服务，发现是一个 [WordPress](https://so.csdn.net/so/search?q=WordPress&spm=1001.2101.3001.7020) 站点登录页面：

此时继续访问 9001 端口可访问查看 Hfish 蜜罐[后台管理系统](https://so.csdn.net/so/search?q=后台管理系统&spm=1001.2101.3001.7020)：

账户密码默认都是 admin（可进入容器使用`vi HFish/config.ini`命令修改默认密码），成功进入平台，攻击数据暂时都还为空值：


4.攻击蜜罐


下面借助局域网内部的 Kali Linux 虚拟机对 Hfish 蜜罐系统进行模拟攻击，以观察 Hfish 蜜罐系统后台对攻击行为的捕抓和记录效果。

Nmap先扫描centos8蜜罐主机的端口：

观察蜜罐的记录效果：

4
